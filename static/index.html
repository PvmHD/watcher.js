<html>
	<head>
		<title>watcher.js</title>

		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">
		<link rel="stylesheet" href="/asset/watcher.css">
		<meta author="boboman13" />
	</head>

	<body>
		<div class="pure-g">
			<div class="span-2"></div>
			<div class="span-6">
				<div class="pure-menu pure-menu-open pure-menu-horizontal">
					<ul>
						<li><a href="#" class="pure-button pure-button-active" title="Dedicated database node; San Jose">MySQL</a></li>
						<li><a href="#" class="pure-button" title="Dedicated frontend web node; San Jose">Website</a></li>
						<li><a href="#" class="pure-button" title="Static file delivery node; New York">CDN (New York)</a></li>
						<li><a href="#" class="pure-button" title="Static file delivery node; Great Britain">CDN (Great Britain)</a></li>
						<li><a href="#" class="pure-button" title="All node backup server; San Antonio">Backup</a></li>
						<li><a href="#" class="pure-button" title="Development, test node; San Antonio">Dev Node</a></li>
					</ul>
				</div>
			</div>
			<div class="span-2"></div>
		</div>

		<div class="pure-g">
			<div class="span-1"></div>
			
			<div class="span-3">
				<div class="content">
					<div class="block-title">
						<h2>CPU Usage <small id="cpu-cores"></small></h2>
					</div>
					<div class="block">
						<div class="span-3">
							<h2 id="cpu-1">...</h2>
							<h3>1 min</h3>
						</div>
						<div class="span-3">
							<h2 id="cpu-2">...</h2>
							<h3>5 min</h3>
						</div>
						<div class="span-3">
							<h2 id="cpu-3">...</h2>
							<h3>15 min</h3>
						</div>
					</div>
				</div>

				<div class="content">
					<div class="block-title">
						<h2>Disk Usage</h2>
					</div>
					<div class="block">
						<table class="pure-table pure-table-horizontal block-table" id="disk-usage-table">
							<thead>
								<tr>
									<th>Filesystem</th>
									<th>Used</th>
									<th>Available</th>
								</tr>
							</thead>

							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="span-5">
				<div class="content">
					<div class="block-title">
						<h2>Network</h2>
					</div>
					<div class="block">

					</div>
				</div>

				<div class="content">
					<div class="block-title">
						<h2>RAM Usage</h2>
					</div>
					<div class="block block-padded">
						<div class="span-3">
							<h2 id="ram-total">...</h2>
							<h3>Total RAM</h3>
						</div>
						<div class="span-3">
							<h2 id="ram-free">...</h2>
							<h3>Free RAM</h3>
						</div>
						<div class="span-3">
							<h2 id="ram-used">...</h2>
							<h3>Used RAM</h3>
						</div>
					</div>
				</div>
			</div>

			<div class="span-1"></div>
		</div>

		<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
		<script>
		$(document).ready(function() {
			function getAmount(data) {
				data = parseInt(data);

				// go through
				if(data > 1024 * 10) {

					if(data / 1024 > 1024 * 10) {

						if(data / Math.pow(1024, 2) > 1024 * 10) {

							if(data / Math.pow(1024, 3) > 1024 * 10) {
								return Math.round(data / Math.pow(1024, 3)) + 'GB';
							} else {
								return Math.round(data / Math.pow(1024, 3)) + 'GB';
							}

						} else {
							return Math.round(data / Math.pow(1024, 2)) + 'MB';
						}

					} else {
						return Math.round(data / 1024) + 'KB';
					}

				} else {
					return data + ' bytes';
				}
			}

			function refreshData() {
				console.log('watcher.js - refreshing data');

				// perform ajax
				$.ajax({
					url: '/get/server',
					type: 'GET',
					success: function(data) {
						// load average
						$("#cpu-1").text(data.load_average.one_min);
						$("#cpu-2").text(data.load_average.five_min);
						$("#cpu-3").text(data.load_average.fifteen_min);
						// num cpu
						$("#cpu-cores").text(data.num_cpu);
						// ram usage
						var memtotal = parseInt(data.mem_usage.total), memfree = parseInt(data.mem_usage.free), memused = memtotal - memfree;
						var perfree = Math.round((memfree / memtotal) * 100), perused = Math.round((memused / memtotal) * 100);
						$("#ram-total").text(getAmount(memtotal));
						$("#ram-free").text(getAmount(memfree)+' ('+perfree+'%)');
						$("#ram-used").text(getAmount(memused)+' ('+perused+'%)');

						// disk usage
						$("#disk-usage-table > tbody").empty();
						for(var i in data.disk_usage) {
							var system = data.disk_usage[i].system;
							var used = data.disk_usage[i].used;
							var available  = data.disk_usage[i].available;
							var percent = data.disk_usage[i].percent;
							$("#disk-usage-table > tbody").append('<tr><td>'+system+'</td><td>'+getAmount(used)+'</td><td>'+getAmount(available)+' ('+percent+')</td></tr>');
						}
					}
				});
			}

			setInterval(refreshData, 5000);
			refreshData();
		});
		</script>
	</body>
</html>